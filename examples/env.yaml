# Environment Variable Hierarchy Example
#
# This example demonstrates environment variables at multiple levels:
# 1. File-level (top-level env)
# 2. Sandbox-level (sandbox.env)
# 3. Test-level (test.env)
# 4. Command-level (run.env)
#
# Higher levels override lower levels.

version: 1

# File-level env (applies to all tests)
env:
  FILE_VAR: "from file"
  SHARED: "file value"
  OVERRIDE_TEST: "file"

sandbox:
  workdir: temp
  # Sandbox-level env (overrides file-level)
  env:
    SANDBOX_VAR: "from sandbox"
    SHARED: "sandbox value"

tests:
  # Test using file-level env
  - name: file_env
    run:
      cmd: sh
      args: ["-c", "echo $FILE_VAR"]
    expect:
      exit: 0
      stdout:
        contains: "from file"

  # Test using sandbox env (overrides file)
  - name: sandbox_env
    run:
      cmd: sh
      args: ["-c", "echo $SHARED"]
    expect:
      exit: 0
      stdout:
        contains: "sandbox value"

  # Test-level env (overrides sandbox)
  - name: test_env_override
    env:
      SHARED: "test value"
      TEST_ONLY: "from test"
    run:
      cmd: sh
      args: ["-c", "echo SHARED=$SHARED TEST_ONLY=$TEST_ONLY"]
    expect:
      exit: 0
      stdout:
        contains: "SHARED=test value"

  # Command-level env (overrides test)
  - name: command_env_override
    env:
      OVERRIDE_TEST: "test"
    run:
      cmd: sh
      args: ["-c", "echo $OVERRIDE_TEST"]
      env:
        OVERRIDE_TEST: "command"
    expect:
      exit: 0
      stdout:
        contains: "command"

  # Full hierarchy demonstration
  - name: full_hierarchy
    env:
      LEVEL: "test"
    run:
      cmd: sh
      args: ["-c", "echo FILE=$FILE_VAR SANDBOX=$SANDBOX_VAR LEVEL=$LEVEL"]
    expect:
      exit: 0
      stdout:
        contains: "FILE=from file"
